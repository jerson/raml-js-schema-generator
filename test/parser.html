<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF8"/>
    <title>RAML Parser Schema Generator</title>
</head>
<style>
    * {
        font-family: "Helvetic Neue", Helvetica, Arial;
        font-size: 13px;
        margin: 2px;
    }

    body {
        margin: 20px;
    }

    body > div {
        width: 49%;
        display: inline-block;
        vertical-align: top;
    }

    textarea {
        width: 100%;
        resize: vertical;
    }

    pre {
        padding: 10px;
        margin: 10px;
        background: #f4f4f4;
    }

</style>
<body>
<div>
    <div>
        <label for="files">Example input files: </label><select id="files">
        <option value='api'>World Music</option>
    </select>
    </div>
    <div>
        <label for="languages">Schema Languages: </label><select id="languages">
        <option value='mysql'>MySQL</option>
    </select>
    </div>
    <div>
        <label for="input">Input RAML: </label><textarea id="input" rows="20"></textarea>
    </div>
    <div>
        <button type="button" id="clean">Clean</button>
        <button type="button" id="process">Process</button>
    </div>
</div>
<div>
    <pre id="output">Output</pre>
</div>

<script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="../node_modules/raml-parser/dist/raml-parser.js"></script>
<script type="text/javascript" src="../dist/raml-js-schema-generator.1.0.0.min.js"></script>
<script type="text/javascript" src="http://localhost:35729/livereload.js?snipver=1"></script>
<script type="text/javascript">

    var generators = require('raml-schema-generators');
    var $output = $('#output'); // $? wtf? moving the PHP horrible torture to JS? <--- .|.
    var $input = $('#input');
    var $files = $('#files');
    var $languages = $('#languages');
    var $clean = $('#clean');
    var $process = $('#process');

    var generateSchema = function (ast) {

        var selectedLanguage = $languages.find('option:selected').val();
        return generators[selectedLanguage](ast, {});

    };

    $clean.on('click', function () {
        $output.empty();
        $input.val('');
    });

    $files.on('change', function () {
        var filename = $('option:selected', this).val();
        $input.load('../test/fixtures/' + filename + '.raml', function () {
            $input.trigger('keypress');
        });
    });

    $input.on('keypress keyup change', function() {
        process($(this).val());
    });
    
    var process = function (value) {
        $output.text('Processing...');
         RAML.Parser.load(value).then(function (data) {

            var generatedScript = generateSchema(data).files;
            var outputFiles = [];

            Object.keys(generatedScript).forEach(function (fileName) {
                outputFiles.push('[' + fileName + ']\n' + generatedScript[fileName] + '\n');
            });

            $output.text(outputFiles.join('\n-------------------------------\n'));
        }, function (error) {
            $output.text(error);
        });
    };
    
    $process.click(function(){
        process($input.val());
    });

    $files.trigger('change');

</script>
</body>

</html>